---
title: "Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(rmarkdown.html_vignette.check_title = FALSE)
```

In this tutorial, we demonstrate the key functionality of the `RaCE.NMA` package on a hypothetical dataset of results from a network meta-analysis (NMA). The tutorial includes code for model estimation and visualization of results. We begin by loading necessary packages.

```{r warning=FALSE,message=FALSE}
library(RaCE.NMA)
library(reshape2) # data reformatting
library(ggplot2)  # creating nice figures
```

## Exploratory Data Analysis

```{r fig.asp=0.5}
mu_hat <- c(-1, 0, 1, 0)
sigma_hat <- c(0.1, 0.1, 0.1, 1)
posterior <- matrix(rnorm(10000,mean=mu_hat,sd=sigma_hat),ncol=4,byrow=T)

ggplot(melt(posterior),aes(y=factor(Var2),x=value))+
  geom_violin()+theme_bw()+theme(panel.grid.minor = element_blank(),panel.grid.major.x = element_blank())+
  labs(y="Treatment",x="Posterior Relative Intervention Effect")
```




## Estimation

Now, let's fit the RaCE model to our data.

```{r}
mcmc <- mcmc_RCMVN(posterior = posterior)
```


Before proceeding, we ensure the chains have converged by assessing trace plots of $K$ and $\mu_j$ and by calculating the $\hat{R}$ of each $\mu_j$ parameter.

```{r}
createtrace_mu(mcmc)
createtrace_K(mcmc)
calculate_Rhat(mcmc)
```

## Inference

Often, we are most interested in creating a clustering probability matrix and a cumulative ranking curve. We create these plots in the code chunks below.

```{r fig.asp=0.6}
create_clustermatrix(mcmc, label_ranks = 1:4)
```
```{r fig.asp=0.4}
create_cumulativeranking(mcmc)
```

The package also includes functions to produce violin and forest plots of model posteriors.

```{r}
create_violinplot(mcmc)
create_forestplot(mcmc)
```
